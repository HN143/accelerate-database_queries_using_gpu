# Ph√¢n t√≠ch th·ªùi gian th·ª±c thi truy v·∫•n HeavyDB

D·ª±a tr√™n file log `heavydb.INFO.20250419-001537.log`, ph√¢n t√≠ch d∆∞·ªõi ƒë√¢y t√≥m t·∫Øt th·ªùi gian th·ª±c thi c√°c b∆∞·ªõc ch√≠nh trong qu√° tr√¨nh x·ª≠ l√Ω truy v·∫•n SQL. T·ªïng th·ªùi gian th·ª±c thi truy v·∫•n l√† **2264 ms**.

---

## 1. T·ªïng quan th·ªùi gian th·ª±c thi

-   **T·ªïng th·ªùi gian (sql_execute):** 2264 ms
-   **Th·ªùi gian th·ª±c thi th·ª±c t·∫ø:** 2234 ms (~98.7%)

**Nh·∫≠n x√©t:**  
Th·ªùi gian th·ª±c thi cao h∆°n truy v·∫•n ƒë∆°n gi·∫£n (1403 ms) nh∆∞ng th·∫•p h∆°n truy v·∫•n ph·ª©c t·∫°p (2934 ms), do truy v·∫•n n√†y c√≥ subquery, nhi·ªÅu ph√©p JOIN, v√† kh·ªëi l∆∞·ª£ng d·ªØ li·ªáu ƒë·∫ßu ra l·ªõn (**18894 d√≤ng**).

---

## 2. C√°c b∆∞·ªõc ch√≠nh v√† th·ªùi gian

### 2.1. Ph√¢n t√≠ch c√∫ ph√°p v√† t·ªëi ∆∞u h√≥a (`parse_to_ra`)

-   **Th·ªùi gian:** 942 ms (~41.6%)
-   **Chi ti·∫øt:**
    -   `processCalciteRequest`: 918 ms
    -   `processImpl`: 917 ms

**Nh·∫≠n x√©t:**  
Chi·∫øm t·ª∑ l·ªá l·ªõn do truy v·∫•n ph·ª©c t·∫°p v·ªõi subquery v√† nhi·ªÅu ph√©p JOIN.

---

### 2.2. Th·ª±c thi Relational Algebra (`execute_rel_alg`)

-   **Th·ªùi gian:** 1309 ms (~57.8%)
-   **C√°c b∆∞·ªõc RelAlg (executeRelAlgStep):**
    1. 337 ms (bi√™n d·ªãch GPU 235 ms, th·ª±c thi kernel 93 ms)
    2. 5 ms
    3. 402 ms (bi√™n d·ªãch GPU 92 ms, th·ª±c thi kernel 128 ms)
    4. 102 ms (bi√™n d·ªãch GPU 90 ms, th·ª±c thi kernel 4 ms)
    5. 4 ms
    6. 214 ms (th·ª±c thi kernel 132 ms)
    7. 223 ms (executeSort 211 ms, bi√™n d·ªãch GPU 99 ms, s·∫Øp x·∫øp 10 ms)

**Nh·∫≠n x√©t:**  
C√°c b∆∞·ªõc 1, 3, 6 v√† 7 chi·∫øm nhi·ªÅu th·ªùi gian do bi√™n d·ªãch v√† th·ª±c thi kernel.

---

### 2.3. Chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ (`convertRows`)

-   **Th·ªùi gian:** 0 ms

**Nh·∫≠n x√©t:**  
Kh√¥ng ƒë√°ng k·ªÉ.

---

## 3. Ph√¢n t√≠ch chi ti·∫øt b∆∞·ªõc th·ª±c thi (`executeWorkUnit`)

-   **T·ªïng th·ªùi gian:** ~1068 ms
-   **C√°c th√†nh ph·∫ßn ch√≠nh:**
    -   **Bi√™n d·ªãch m√£ GPU (compileWorkUnit):** ~526 ms
        -   `optimizeAndCodegenGPU`: ~540 ms
            -   `ptx_to_cubin`: 77‚Äì113 ms m·ªói l·∫ßn
            -   `generatePTX`: ~7‚Äì8 ms
            -   `optimize_ir`: ~3‚Äì5 ms
    -   **Th·ª±c thi kernel (launchGpuCode):** ~263 ms
    -   **L·∫•y d·ªØ li·ªáu (fetchChunks):** ~8 ms
    -   **S·∫Øp x·∫øp k·∫øt qu·∫£:**
        -   `executeSort`: 10 ms
        -   `reduceMultiDeviceResults`: ~3‚Äì10 ms m·ªói l·∫ßn

---

## 4. L√Ω do th·ªùi gian th·ª±c thi cao

### üîπ ƒê·ªô ph·ª©c t·∫°p c·ªßa truy v·∫•n

-   C√≥ `subquery`, `GROUP BY`, nhi·ªÅu `JOIN` v√† ƒëi·ªÅu ki·ªán l·ªçc ph·ª©c t·∫°p.
-   D·ªØ li·ªáu ƒë·∫ßu ra l·ªõn (**18894 d√≤ng**) c·∫ßn nhi·ªÅu th·ªùi gian s·∫Øp x·∫øp.

### üîπ Nhi·ªÅu b∆∞·ªõc RelAlg

-   **7 b∆∞·ªõc RelAlg** (so v·ªõi 1 b∆∞·ªõc ·ªü truy v·∫•n ƒë∆°n gi·∫£n).
-   C√°c b∆∞·ªõc nh∆∞ `executeCompound` v√† `executeSort` t·ªën th·ªùi gian.

### üîπ Bi√™n d·ªãch GPU nhi·ªÅu l·∫ßn

-   T·ªïng th·ªùi gian bi√™n d·ªãch GPU cao (**~526 ms**).
-   Cache m√£ GPU **kh√¥ng ƒë∆∞·ª£c t√°i s·ª≠ d·ª•ng hi·ªáu qu·∫£**, d·∫´n ƒë·∫øn bi√™n d·ªãch l·∫∑p l·∫°i.

### üîπ Kh·ªëi l∆∞·ª£ng d·ªØ li·ªáu l·ªõn

-   **T·ªïng s·ªë d√≤ng ƒë·∫ßu v√†o:** 150015
-   D√π `fetchChunks` nhanh (~8 ms), kernel v·∫´n x·ª≠ l√Ω nhi·ªÅu d·ªØ li·ªáu.

### üîπ H·∫°n ch·∫ø ph·∫ßn c·ª©ng

-   Ch·ªâ d√πng **1 GPU** (3.79 GB VRAM) c√≥ th·ªÉ g√¢y **bottleneck**.

---

## 5. Nh·∫≠n x√©t chung

-   `execute_rel_alg` (**1309 ms**) l√† ph·∫ßn t·ªën th·ªùi gian nh·∫•t.
-   `parse_to_ra` c≈©ng t·ªën th·ªùi gian (**942 ms**) do truy v·∫•n ph·ª©c t·∫°p.
-   Truy v·∫•n **·ªïn ƒë·ªãnh**, **kh√¥ng l·ªói/c·∫£nh b√°o** trong log.
-   T·ªïng th·ªùi gian th·ª±c thi cao (**2264 ms**) l√† do:
    -   Truy v·∫•n ph·ª©c t·∫°p
    -   Nhi·ªÅu b∆∞·ªõc RelAlg
    -   D·ªØ li·ªáu ƒë·∫ßu ra l·ªõn
